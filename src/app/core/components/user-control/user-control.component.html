@if (userData) {
<div class="user-control">
  <button type="button" class="user-trigger" (click)="userMenu.toggle($event)" aria-label="Menú de usuario"
    aria-haspopup="true">
    <span class="user-avatar">{{ getInitials() }}</span>
    <span class="user-name">{{ getFullName() }}</span>
    <i class="pi pi-chevron-down trigger-chevron"></i>
  </button>
  <p-popover #userMenu [dismissable]="true" styleClass="user-menu-popover">
    <div class="user-menu-content">
      <div class="user-menu-header">
        <span class="user-menu-value name">{{ getFullName() }}</span>
        @if (companyDescription) {
        <span class="user-menu-value company">{{ companyDescription }}</span>
        }
        @if (companyNit) {
        <span class="user-menu-value company">NIT: {{ companyNit }}</span>
        }
      </div>
      <div class="user-menu-config">
        <button type="button" class="menu-btn config-btn" (click)="navigateToOperacionesAndClose(userMenu)">
          <i class="pi pi-list"></i> Ver Operaciones
        </button>
        <button type="button" class="menu-btn config-btn" (click)="navigateToChangePasswordAndClose(userMenu)">
          <i class="pi pi-key"></i> Cambiar Contraseña
        </button>
      </div>
      <div class="user-menu-theme">
        <span class="theme-label">{{ darkMode ? 'Modo oscuro' : 'Modo claro' }}</span>
        <button type="button" class="theme-toggle" (click)="onToggleDarkMode()"
          [attr.aria-label]="darkMode ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro'">
          {{ darkMode ? '☀' : '☾' }}
        </button>
      </div>
      <div class="user-menu-actions">
        <button type="button" class="menu-btn logout-btn" (click)="onLogoutClick(userMenu)">
          <i class="pi pi-sign-out"></i> Cerrar Sesión
        </button>
      </div>
    </div>
  </p-popover>
</div>
}